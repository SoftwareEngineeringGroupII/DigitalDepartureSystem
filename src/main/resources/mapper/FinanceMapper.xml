<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.digitaldeparturesystem.mapper.FinanceMapper">

    <!--根据学号查询学生财务缴费情况-->
    <select id="getStudentByIdForFinance" parameterType="String" resultType="java.util.Map">
        select
          s.`stuNumber`,
          s.`stuName`,
          s.`stuDept`,
          s.`stuType`,
          f.`expense`,
          f.`financeStatus`
          FROM
           student s
           LEFT JOIN finance f
           ON s.stuID = f.stuID
           <where>
               <if test="stuNumber!=null and stuId!=''">
                   AND s.`stuNumber` = #{stuNumber}
               </if>
           </where>
    </select>

    <!--按条件分页查询财务处缴费审核情况：按学院、学生类型、审核状态-->
    <select id="listStudentFinanceInfos" parameterType="map" resultType="java.util.Map">
        SELECT
           s.stuNumber,
           s.stuType,
           s.stuDept,
           s.stuName,
           f.expense,
           f.financeStatus
        FROM
          student s
        LEFT JOIN finance f
        ON s.stuID = f.stuID
        <where>
            <if test="params.stuDept!=null and params.stuDept!=''">
                AND s.stuDept = #{params.stuDept}
            </if>
            <if test="params.stuType!=null and params.stuType!=''">
                AND s.stuType = #{params.stuType}
            </if>
            <if test="params.financeStatus!=null and params.financeStatus!=''">
                AND f.financeStatus = #{params.financeStatus }
            </if>
        </where>
    </select>

    <!--财务处审核-->
    <update id="doCheckForFinance" parameterType="String">
       update finance set expense=0 ,financeStatus=1 where stuID=#{stuID}
    </update>


</mapper>