<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.digitaldeparturesystem.mapper.CardMapper">


    <!--根据学院类型，学生类型，审核状态查询学生信息 - 一卡通-->
    <select id="listStudentCardInfos" resultType="java.util.Map" parameterType="map">
        SELECT
        s.`stuID`,
        s.`stuNumber`,
        s.`stuName`,
        s.`stuDept`,
        s.`stuType`,
        c.`cardBalance`,
        c.`cardStatus`
        FROM
        student s
        LEFT JOIN card c
        ON s.stuID = c.stuID
        <where>
            <if test="params.stuDept!=null and params.stuDept!= ''">
                AND s.`stuDept` = #{params.stuDept}
            </if>
            <if test="params.stuType!=null and params.stuType!= ''">
                AND s.`stuType`  = #{params.stuType}
            </if>
            <if test="params.cardStatus!=null and params.cardStatus!= ''">
                AND c.`cardStatus` = #{params.cardStatus}
            </if>
        </where>
    </select>

    <!--根据学号查询某一学生一卡通详情-->
    <select id="getStudentByIdForCard" parameterType="String" resultType="java.util.Map">
        select
        s.`stuNumber`,
        s.`stuName`,
        s.`stuDept`,
        s.`stuType`,
        c.`cardBalance`,
        c.`cardStatus`
        FROM
        student s
        LEFT JOIN card c
        ON s.stuID = c.stuID
        <where>
            <if test="stuId!=null and stuId!=''">
                AND s.`stuNumber` = #{stuNum}
            </if>
        </where>
    </select>

    <!--审核一卡通状态-->
    <update id="doCheckCard" parameterType="String">
       update card set cardBalance=0,cardStatus=1 where stuID=#{stuId}
    </update>




</mapper>